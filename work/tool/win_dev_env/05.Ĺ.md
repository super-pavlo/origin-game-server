### window平台上开发环境的构建
- 可基于vm虚拟机，安装centos系统，进行开发
- 可基于window平台上docker环境，进行开发，MAC也可以用同样的方法构建

### docker开发环境的构建
- 相关构建文件在`tool\win_dev_env`文件夹下面
- 安装docker软件，[软件地址](http://get.daocloud.io/#install-docker-for-mac-windows)，系统需要在BIOS，开启支持Hyper-V
- 进入`tool\win_dev_env`文件夹，根据需要修改[build_docker.sh](./build_docker.sh)脚本，

    ```shell
    1. -p ${map_ssh}:22 本地端口映射到系统的端口
    2. -v //d/server:/home/server 本地目录[d/server] 映射到系统的[/home/server]
    3. d/server 一般为本地代码仓库目录，示例为D盘下server目录
    ```
- 运行命令 `./build_docker.sh coe 0`，可在git bash内执行该命令
- 执行成功后，即拥有一个完整的编译开发环境(已安装vim、git、mysql、mongodb、telnet、libfaketime)

### dokcer环境下时间调整
- 在dokcer环境内无法正常进行时间调整，调整完后会过几秒会恢复与宿主机一样的时间
- 可依赖于libfaketime进行时间调整，docker构建脚本已安装
- 高版本libfaketime使用需要禁用`JEMALLOC`
- libfaketime使用方法如下：

    start_xxx.sh文件内需要以下配置：
    ```shell
    export LD_PRELOAD=/usr/local/lib/faketime/libfaketime.so.1 
    export FAKETIME_DONT_RESET=1 
    export FAKETIME_NO_CACHE=1
    ```

    在lua代码代码中可这样使用：
    ```lua
    os.execute(string.format("echo '%s' > ~/.faketimerc", "+"..diff))
    ```

    也可以直接在shell中使用:
    ```shell
    echo "2020-12-12 12:20:20" >　~/.faketimerc
    ```

    更多使用方式可以参考 [libfaketime主页](!https://github.com/wolfcw/libfaketime)


### docker环境下无法在宿主机目录生成core文件
- 相关配置已在docker构建脚本
- 需要在docker环境下执行 `sysctl -p`

### 项目初始化及编译
- 通过`ssh root@localhost` 密码：root，或者通过docker界面都可以进入开发环境中
- 进入`/home/server/tool/win_dev_env`目录中，执行`init_mysql.sh`文件，可初始化数据库
- 进入`/home/server`目录中，执行命令`make`，即可开始编译